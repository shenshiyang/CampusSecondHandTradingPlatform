{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      userList: [],\n      chatList: [],\n      chatTitle: '',\n      active: null,\n      content: '',\n      activeUserAvatar: '',\n      showEmojiPanel: false,\n      emojiList: ['üòä', 'üòÇ', 'ü§£', '‚ù§Ô∏è', 'üòç', 'üòí', 'üòò', 'üòÖ', 'üò≠', 'üòâ', 'üòé', 'ü§î', 'üò§', 'üò°', 'üò±', 'ü§Æ', 'ü§ë', 'ü§ù', 'üëç', 'üëé', 'üôè', 'üí™', 'üëÄ', 'üéâ']\n    };\n  },\n  mounted() {\n    const toUserId = this.$route.query.toUserId;\n    this.loadUserList().then(() => {\n      if (toUserId) {\n        const target = this.userList.find(u => u.chatUserId == toUserId);\n        if (target) {\n          this.changeChatUser(target);\n        }\n      }\n    });\n  },\n  methods: {\n    loadUserList() {\n      return this.$request.get('/chatGroup/selectUserGroup').then(res => {\n        if (res.code === '200') {\n          this.userList = res.data;\n        }\n      });\n    },\n    changeChatUser(item) {\n      this.chatTitle = item.chatUserName || 'ÂØπÊñπ';\n      this.active = item.chatUserId;\n      this.activeUserAvatar = item.chatUserAvatar;\n      this.loadChatRecord();\n    },\n    loadChatRecord() {\n      this.$request.get(`/chatInfo/selectUserChat/${this.active}`).then(res => {\n        if (res.code === '200') {\n          this.chatList = res.data;\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            if (box) box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    },\n    parseEmoji(text) {\n      return text || '';\n    },\n    insertEmoji(emoji) {\n      this.content += emoji;\n      this.showEmojiPanel = false;\n    },\n    beforeFileUpload(file) {\n      const maxSize = 100 * 1024 * 1024; // 100MB (Ê†πÊçÆÂêéÁ´ØÈÖçÁΩÆ)\n      if (file.size > maxSize) {\n        this.$message.error('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá100MB');\n        return false;\n      }\n      return true;\n    },\n    handleFileSuccess(res) {\n      if (res.code === '200') {\n        const fileUrl = res; // ÂêéÁ´ØÁõ¥Êé•ËøîÂõûÊñá‰ª∂URL\n        const fileMsg = {\n          userId: this.user.id,\n          chatUserId: this.active,\n          type: 'file',\n          fileName: fileUrl.substring(fileUrl.lastIndexOf('/') + 1),\n          fileUrl: fileUrl,\n          text: `[Êñá‰ª∂] ${fileUrl.substring(fileUrl.lastIndexOf('/') + 1)}`\n        };\n        this.$request.post('/chatInfo/add', fileMsg).then(res => {\n          if (res.code === '200') {\n            this.chatList.push(fileMsg);\n            this.$nextTick(() => {\n              const box = this.$refs.chatBox;\n              if (box) box.scrollTop = box.scrollHeight;\n            });\n          }\n        });\n      } else {\n        this.$message.error('Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•');\n      }\n    },\n    downloadFile(url) {\n      window.open(url);\n    },\n    send() {\n      if (!this.content.trim()) return;\n      const msg = {\n        userId: this.user.id,\n        chatUserId: this.active,\n        type: 'text',\n        text: this.content\n      };\n      this.$request.post('/chatInfo/add', msg).then(res => {\n        if (res.code === '200') {\n          this.chatList.push(msg);\n          this.content = '';\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            if (box) box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["data","user","JSON","parse","localStorage","getItem","userList","chatList","chatTitle","active","content","activeUserAvatar","showEmojiPanel","emojiList","mounted","toUserId","$route","query","loadUserList","then","target","find","u","chatUserId","changeChatUser","methods","$request","get","res","code","item","chatUserName","chatUserAvatar","loadChatRecord","$nextTick","box","$refs","chatBox","scrollTop","scrollHeight","parseEmoji","text","insertEmoji","emoji","beforeFileUpload","file","maxSize","size","$message","error","handleFileSuccess","fileUrl","fileMsg","userId","id","type","fileName","substring","lastIndexOf","post","push","downloadFile","url","window","open","send","trim","msg"],"sources":["src/views/front/Chat.vue"],"sourcesContent":["<template>\n  <div class=\"chat-page\">\n    <div class=\"chat-user-list\">\n      <div\n        v-for=\"item in userList\"\n        :key=\"item.chatUserId\"\n        :class=\"['chat-user', item.chatUserId === active ? 'active' : '']\"\n        @click=\"changeChatUser(item)\">\n        <img :src=\"item.chatUserAvatar\" alt=\"\">\n        <span>{{ item.chatUserName }}</span>\n      </div>\n    </div>\n\n    <div class=\"chat-main\">\n      <div class=\"chat-title\">{{ chatTitle }}</div>\n\n      <div class=\"chat-box\" ref=\"chatBox\">\n        <div\n          v-for=\"(item, index) in chatList\"\n          :key=\"index\"\n          :class=\"['msg-box', item.userId === user.id ? 'right' : 'left']\">\n          <img\n            class=\"avatar\"\n            :src=\"item.userId === user.id ? user.avatar : activeUserAvatar\"\n            alt=\"Â§¥ÂÉè\">\n          <div class=\"msg-content\" v-if=\"item.type === 'text'\" v-html=\"parseEmoji(item.text)\"></div>\n          <div class=\"msg-content file-content\" v-else-if=\"item.type === 'file'\">\n            <div class=\"file-info\" @click=\"downloadFile(item.fileUrl)\">\n              <i class=\"el-icon-document\"></i>\n              <span>{{ item.fileName }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"chat-toolbar\">\n        <div class=\"toolbar-left\">\n          <i class=\"el-icon-smile\" @click=\"showEmojiPanel = !showEmojiPanel\"></i>\n          <el-upload\n            class=\"file-upload\"\n            action=\"/files/upload\"\n            :show-file-list=\"false\"\n            :before-upload=\"beforeFileUpload\"\n            :on-success=\"handleFileSuccess\">\n            <i class=\"el-icon-folder\"></i>\n          </el-upload>\n        </div>\n        \n        <!-- Ë°®ÊÉÖÈù¢Êùø -->\n        <div class=\"emoji-panel\" v-if=\"showEmojiPanel\">\n          <div class=\"emoji-list\">\n            <span\n              v-for=\"(emoji, index) in emojiList\"\n              :key=\"index\"\n              class=\"emoji-item\"\n              @click=\"insertEmoji(emoji)\">\n              {{ emoji }}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"chat-input\">\n        <el-input \n          v-model=\"content\" \n          type=\"textarea\"\n          :rows=\"3\"\n          placeholder=\"ËØ∑ËæìÂÖ•ËÅäÂ§©ÂÜÖÂÆπ\" \n          @keyup.ctrl.enter.native=\"send\"\n          resize=\"none\" />\n        <el-button type=\"primary\" @click=\"send\">ÂèëÈÄÅ</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      userList: [],\n      chatList: [],\n      chatTitle: '',\n      active: null,\n      content: '',\n      activeUserAvatar: '',\n      showEmojiPanel: false,\n      emojiList: ['üòä', 'üòÇ', 'ü§£', '‚ù§Ô∏è', 'üòç', 'üòí', 'üòò', 'üòÖ', 'üò≠', 'üòâ', 'üòé', 'ü§î', 'üò§', 'üò°', 'üò±', 'ü§Æ', 'ü§ë', 'ü§ù', 'üëç', 'üëé', 'üôè', 'üí™', 'üëÄ', 'üéâ']\n    }\n  },\n  mounted() {\n    const toUserId = this.$route.query.toUserId;\n    this.loadUserList().then(() => {\n      if (toUserId) {\n        const target = this.userList.find(u => u.chatUserId == toUserId);\n        if (target) {\n          this.changeChatUser(target);\n        }\n      }\n    });\n  },\n  methods: {\n    loadUserList() {\n      return this.$request.get('/chatGroup/selectUserGroup').then(res => {\n        if (res.code === '200') {\n          this.userList = res.data;\n        }\n      });\n    },\n    changeChatUser(item) {\n      this.chatTitle = item.chatUserName || 'ÂØπÊñπ';\n      this.active = item.chatUserId;\n      this.activeUserAvatar = item.chatUserAvatar;\n      this.loadChatRecord();\n    },\n    loadChatRecord() {\n      this.$request.get(`/chatInfo/selectUserChat/${this.active}`).then(res => {\n        if (res.code === '200') {\n          this.chatList = res.data;\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            if (box) box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    },\n    parseEmoji(text) {\n      return text || '';\n    },\n    insertEmoji(emoji) {\n      this.content += emoji;\n      this.showEmojiPanel = false;\n    },\n    beforeFileUpload(file) {\n      const maxSize = 100 * 1024 * 1024; // 100MB (Ê†πÊçÆÂêéÁ´ØÈÖçÁΩÆ)\n      if (file.size > maxSize) {\n        this.$message.error('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá100MB');\n        return false;\n      }\n      return true;\n    },\n    handleFileSuccess(res) {\n      if (res.code === '200') {\n        const fileUrl = res;  // ÂêéÁ´ØÁõ¥Êé•ËøîÂõûÊñá‰ª∂URL\n        const fileMsg = {\n          userId: this.user.id,\n          chatUserId: this.active,\n          type: 'file',\n          fileName: fileUrl.substring(fileUrl.lastIndexOf('/') + 1),\n          fileUrl: fileUrl,\n          text: `[Êñá‰ª∂] ${fileUrl.substring(fileUrl.lastIndexOf('/') + 1)}`\n        };\n        this.$request.post('/chatInfo/add', fileMsg).then(res => {\n          if (res.code === '200') {\n            this.chatList.push(fileMsg);\n            this.$nextTick(() => {\n              const box = this.$refs.chatBox;\n              if (box) box.scrollTop = box.scrollHeight;\n            });\n          }\n        });\n      } else {\n        this.$message.error('Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•');\n      }\n    },\n    downloadFile(url) {\n      window.open(url);\n    },\n    send() {\n      if (!this.content.trim()) return;\n      const msg = {\n        userId: this.user.id,\n        chatUserId: this.active,\n        type: 'text',\n        text: this.content\n      };\n      this.$request.post('/chatInfo/add', msg).then(res => {\n        if (res.code === '200') {\n          this.chatList.push(msg);\n          this.content = '';\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            if (box) box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-page {\n  display: flex;\n  height: 85vh;\n  background: #fff;\n  box-shadow: 0 0 6px #ddd;\n  margin: 20px;\n  border-radius: 8px;\n  overflow: hidden;\n}\n.chat-user-list {\n  width: 220px;\n  border-right: 1px solid #eee;\n  overflow-y: auto;\n}\n.chat-user {\n  display: flex;\n  align-items: center;\n  padding: 10px;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.chat-user:hover,\n.chat-user.active {\n  background-color: #f0f7ff;\n}\n.chat-user img {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-right: 10px;\n  object-fit: cover;\n}\n.chat-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n.chat-title {\n  height: 50px;\n  line-height: 50px;\n  padding-left: 20px;\n  border-bottom: 1px solid #eee;\n  font-weight: bold;\n  background: #f8f9fa;\n}\n.chat-box {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  background: #f5f7fa;\n}\n.chat-toolbar {\n  padding: 10px;\n  border-top: 1px solid #eee;\n  position: relative;\n  background: #fff;\n}\n.toolbar-left {\n  display: flex;\n  gap: 15px;\n}\n.toolbar-left i {\n  font-size: 20px;\n  color: #666;\n  cursor: pointer;\n  transition: color 0.3s;\n}\n.toolbar-left i:hover {\n  color: #409EFF;\n}\n.emoji-panel {\n  position: absolute;\n  bottom: 100%;\n  left: 0;\n  background: white;\n  border: 1px solid #eee;\n  border-radius: 8px;\n  padding: 10px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n  z-index: 1000;\n}\n.emoji-list {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  gap: 8px;\n}\n.emoji-item {\n  font-size: 20px;\n  cursor: pointer;\n  text-align: center;\n  padding: 5px;\n  transition: transform 0.2s;\n}\n.emoji-item:hover {\n  transform: scale(1.2);\n  background: #f5f5f5;\n  border-radius: 4px;\n}\n.file-content {\n  padding: 10px !important;\n}\n.file-info {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  padding: 8px 12px;\n  background: #fff;\n  border-radius: 4px;\n  transition: all 0.3s;\n}\n.file-info:hover {\n  background: #f0f7ff;\n}\n.file-info i {\n  font-size: 24px;\n  color: #409EFF;\n}\n.file-info span {\n  color: #409EFF;\n  text-decoration: underline;\n}\n.chat-input {\n  padding: 15px;\n  border-top: 1px solid #eee;\n  background: #fff;\n}\n.chat-input .el-textarea {\n  margin-bottom: 10px;\n}\n.chat-input .el-button {\n  float: right;\n}\n.file-upload {\n  display: inline-block;\n}\n.msg-box {\n  display: flex;\n  align-items: flex-start;\n  margin-bottom: 20px;\n}\n.msg-box.left {\n  flex-direction: row;\n}\n.msg-box.right {\n  flex-direction: row-reverse;\n}\n.avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin: 0 10px;\n  object-fit: cover;\n}\n.msg-content {\n  background: #fff;\n  padding: 10px 15px;\n  border-radius: 4px;\n  max-width: 60%;\n  word-wrap: break-word;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n.msg-box.right .msg-content {\n  background: #e3f2fd;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}