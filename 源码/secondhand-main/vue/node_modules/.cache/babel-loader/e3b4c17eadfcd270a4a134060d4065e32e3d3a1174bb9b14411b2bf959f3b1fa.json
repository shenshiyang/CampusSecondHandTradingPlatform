{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      userList: [],\n      chatList: [],\n      active: null,\n      activeUser: null,\n      chatTitle: '',\n      content: ''\n    };\n  },\n  mounted() {\n    this.loadUserList().then(() => {\n      const toUserId = this.$route.query.toUserId;\n      if (toUserId) {\n        const target = this.userList.find(u => u.chatUserId == toUserId);\n        if (target) {\n          this.changeChatUser(target);\n        } else {\n          // 如果不存在，自动创建会话\n          this.$request.post('/chatGroup/add', {\n            userId: this.user.id,\n            chatUserId: toUserId\n          }).then(() => {\n            this.loadUserList().then(() => {\n              const newTarget = this.userList.find(u => u.chatUserId == toUserId);\n              if (newTarget) this.changeChatUser(newTarget);\n            });\n          });\n        }\n      }\n    });\n  },\n  methods: {\n    loadUserList() {\n      return this.$request.get('/chatGroup/selectUserGroup').then(res => {\n        if (res.code === '200') {\n          this.userList = res.data;\n        }\n      });\n    },\n    changeChatUser(item) {\n      this.active = item.chatUserId;\n      this.activeUser = item;\n      this.chatTitle = item.chatUserName;\n      this.loadChatRecord();\n    },\n    loadChatRecord() {\n      this.$request.get(`/chatInfo/selectUserChat/${this.active}`).then(res => {\n        if (res.code === '200') {\n          this.chatList = res.data;\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    },\n    send() {\n      if (!this.content.trim()) return;\n      const msg = {\n        fromId: this.user.id,\n        toId: this.active,\n        content: this.content,\n        createTime: new Date()\n      };\n      this.$request.post('/chatInfo/add', msg).then(res => {\n        if (res.code === '200') {\n          this.chatList.push({\n            ...msg\n          }); // 展示\n          this.content = '';\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            box.scrollTop = box.scrollHeight;\n          });\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["data","user","JSON","parse","localStorage","getItem","userList","chatList","active","activeUser","chatTitle","content","mounted","loadUserList","then","toUserId","$route","query","target","find","u","chatUserId","changeChatUser","$request","post","userId","id","newTarget","methods","get","res","code","item","chatUserName","loadChatRecord","$nextTick","box","$refs","chatBox","scrollTop","scrollHeight","send","trim","msg","fromId","toId","createTime","Date","push","$message","error"],"sources":["src/views/front/Chat.vue"],"sourcesContent":["<template>\n  <div class=\"chat-page\">\n    <div class=\"chat-user-list\">\n      <div\n        v-for=\"item in userList\"\n        :key=\"item.chatUserId\"\n        :class=\"['chat-user', item.chatUserId === active ? 'active' : '']\"\n        @click=\"changeChatUser(item)\"\n      >\n        <img :src=\"item.chatUserAvatar\" alt=\"\" />\n        <span>{{ item.chatUserName }}</span>\n      </div>\n    </div>\n\n    <div class=\"chat-main\" v-if=\"activeUser\">\n      <div class=\"chat-title\">{{ chatTitle }}</div>\n\n      <div class=\"chat-box\" ref=\"chatBox\">\n        <div\n          v-for=\"(item, index) in chatList\"\n          :key=\"index\"\n          :class=\"['msg', item.fromId === user.id ? 'right' : 'left']\"\n        >\n          <span>{{ item.content }}</span>\n        </div>\n      </div>\n\n      <div class=\"chat-input\">\n        <el-input\n          v-model=\"content\"\n          placeholder=\"请输入聊天内容\"\n          @keyup.enter.native=\"send\"\n        />\n        <el-button type=\"primary\" @click=\"send\">发送</el-button>\n      </div>\n    </div>\n\n    <div class=\"chat-main\" v-else>\n      <div class=\"chat-title\">暂无会话</div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      userList: [],\n      chatList: [],\n      active: null,\n      activeUser: null,\n      chatTitle: '',\n      content: ''\n    }\n  },\n  mounted() {\n    this.loadUserList().then(() => {\n      const toUserId = this.$route.query.toUserId;\n      if (toUserId) {\n        const target = this.userList.find(u => u.chatUserId == toUserId);\n        if (target) {\n          this.changeChatUser(target);\n        } else {\n          // 如果不存在，自动创建会话\n          this.$request.post('/chatGroup/add', {\n            userId: this.user.id,\n            chatUserId: toUserId\n          }).then(() => {\n            this.loadUserList().then(() => {\n              const newTarget = this.userList.find(u => u.chatUserId == toUserId);\n              if (newTarget) this.changeChatUser(newTarget);\n            });\n          });\n        }\n      }\n    });\n  },\n  methods: {\n    loadUserList() {\n      return this.$request.get('/chatGroup/selectUserGroup').then(res => {\n        if (res.code === '200') {\n          this.userList = res.data;\n        }\n      });\n    },\n    changeChatUser(item) {\n      this.active = item.chatUserId;\n      this.activeUser = item;\n      this.chatTitle = item.chatUserName;\n      this.loadChatRecord();\n    },\n    loadChatRecord() {\n      this.$request.get(`/chatInfo/selectUserChat/${this.active}`).then(res => {\n        if (res.code === '200') {\n          this.chatList = res.data;\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            box.scrollTop = box.scrollHeight;\n          });\n        }\n      });\n    },\n    send() {\n      if (!this.content.trim()) return;\n\n      const msg = {\n        fromId: this.user.id,\n        toId: this.active,\n        content: this.content,\n        createTime: new Date()\n      };\n\n      this.$request.post('/chatInfo/add', msg).then(res => {\n        if (res.code === '200') {\n          this.chatList.push({ ...msg }); // 展示\n          this.content = '';\n          this.$nextTick(() => {\n            const box = this.$refs.chatBox;\n            box.scrollTop = box.scrollHeight;\n          });\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-page {\n  display: flex;\n  height: 85vh;\n  background: #fff;\n  box-shadow: 0 0 6px #ddd;\n  margin: 20px;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.chat-user-list {\n  width: 220px;\n  border-right: 1px solid #eee;\n  overflow-y: auto;\n}\n\n.chat-user {\n  display: flex;\n  align-items: center;\n  padding: 10px;\n  cursor: pointer;\n}\n\n.chat-user:hover,\n.chat-user.active {\n  background-color: #f0f7ff;\n}\n\n.chat-user img {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  margin-right: 8px;\n}\n\n.chat-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.chat-title {\n  height: 50px;\n  line-height: 50px;\n  padding-left: 20px;\n  border-bottom: 1px solid #eee;\n  font-weight: bold;\n}\n\n.chat-box {\n  flex: 1;\n  padding: 15px;\n  overflow-y: auto;\n}\n\n.chat-input {\n  display: flex;\n  padding: 10px;\n  border-top: 1px solid #eee;\n}\n\n.chat-input .el-input {\n  flex: 1;\n  margin-right: 10px;\n}\n\n.msg {\n  margin-bottom: 10px;\n  display: flex;\n}\n\n.msg.left {\n  justify-content: flex-start;\n}\n\n.msg.right {\n  justify-content: flex-end;\n}\n\n.msg span {\n  max-width: 60%;\n  background: #e1f3ff;\n  padding: 8px 12px;\n  border-radius: 4px;\n}\n</style>\n"],"mappings":";AA4CA;EACAA,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,QAAA;MACAC,QAAA;MACAC,MAAA;MACAC,UAAA;MACAC,SAAA;MACAC,OAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,YAAA,GAAAC,IAAA;MACA,MAAAC,QAAA,QAAAC,MAAA,CAAAC,KAAA,CAAAF,QAAA;MACA,IAAAA,QAAA;QACA,MAAAG,MAAA,QAAAZ,QAAA,CAAAa,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,UAAA,IAAAN,QAAA;QACA,IAAAG,MAAA;UACA,KAAAI,cAAA,CAAAJ,MAAA;QACA;UACA;UACA,KAAAK,QAAA,CAAAC,IAAA;YACAC,MAAA,OAAAxB,IAAA,CAAAyB,EAAA;YACAL,UAAA,EAAAN;UACA,GAAAD,IAAA;YACA,KAAAD,YAAA,GAAAC,IAAA;cACA,MAAAa,SAAA,QAAArB,QAAA,CAAAa,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,UAAA,IAAAN,QAAA;cACA,IAAAY,SAAA,OAAAL,cAAA,CAAAK,SAAA;YACA;UACA;QACA;MACA;IACA;EACA;EACAC,OAAA;IACAf,aAAA;MACA,YAAAU,QAAA,CAAAM,GAAA,+BAAAf,IAAA,CAAAgB,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAzB,QAAA,GAAAwB,GAAA,CAAA9B,IAAA;QACA;MACA;IACA;IACAsB,eAAAU,IAAA;MACA,KAAAxB,MAAA,GAAAwB,IAAA,CAAAX,UAAA;MACA,KAAAZ,UAAA,GAAAuB,IAAA;MACA,KAAAtB,SAAA,GAAAsB,IAAA,CAAAC,YAAA;MACA,KAAAC,cAAA;IACA;IACAA,eAAA;MACA,KAAAX,QAAA,CAAAM,GAAA,kCAAArB,MAAA,IAAAM,IAAA,CAAAgB,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAxB,QAAA,GAAAuB,GAAA,CAAA9B,IAAA;UACA,KAAAmC,SAAA;YACA,MAAAC,GAAA,QAAAC,KAAA,CAAAC,OAAA;YACAF,GAAA,CAAAG,SAAA,GAAAH,GAAA,CAAAI,YAAA;UACA;QACA;MACA;IACA;IACAC,KAAA;MACA,UAAA9B,OAAA,CAAA+B,IAAA;MAEA,MAAAC,GAAA;QACAC,MAAA,OAAA3C,IAAA,CAAAyB,EAAA;QACAmB,IAAA,OAAArC,MAAA;QACAG,OAAA,OAAAA,OAAA;QACAmC,UAAA,MAAAC,IAAA;MACA;MAEA,KAAAxB,QAAA,CAAAC,IAAA,kBAAAmB,GAAA,EAAA7B,IAAA,CAAAgB,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAxB,QAAA,CAAAyC,IAAA;YAAA,GAAAL;UAAA;UACA,KAAAhC,OAAA;UACA,KAAAwB,SAAA;YACA,MAAAC,GAAA,QAAAC,KAAA,CAAAC,OAAA;YACAF,GAAA,CAAAG,SAAA,GAAAH,GAAA,CAAAI,YAAA;UACA;QACA;UACA,KAAAS,QAAA,CAAAC,KAAA,CAAApB,GAAA,CAAAa,GAAA;QACA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}