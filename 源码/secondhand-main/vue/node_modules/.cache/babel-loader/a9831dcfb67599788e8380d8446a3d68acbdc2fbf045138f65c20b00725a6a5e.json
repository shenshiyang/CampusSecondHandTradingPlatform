{"ast":null,"code":"export default {\n  name: 'Chat',\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      chatUserId: null,\n      // 当前聊天对象 ID\n      messageList: [],\n      // 消息列表\n      inputMsg: '' // 当前输入框内容\n    };\n  },\n\n  created() {\n    const targetId = this.$route.query.userId;\n    if (targetId) {\n      this.chatUserId = targetId;\n      this.createChatIfNeeded(targetId);\n      this.loadMessages(targetId);\n    } else {\n      this.$message.warning('未指定聊天对象');\n    }\n  },\n  methods: {\n    createChatIfNeeded(targetId) {\n      this.$request.post('/chatGroup/add', {\n        userId: this.user.id,\n        chatUserId: targetId\n      }).then(() => {\n        console.log('chatGroup ensured');\n      });\n    },\n    loadMessages(targetId) {\n      this.$request.get(`/chatInfo/list?userId=${this.user.id}&chatUserId=${targetId}`).then(res => {\n        this.messageList = res.data || [];\n        this.$nextTick(() => {\n          this.scrollToBottom();\n        });\n      });\n    },\n    sendMsg() {\n      if (!this.inputMsg.trim()) {\n        this.$message.warning('请输入内容');\n        return;\n      }\n      const msgData = {\n        fromId: this.user.id,\n        toId: this.chatUserId,\n        content: this.inputMsg,\n        module: 'goods' // 模块类型，可选\n      };\n\n      this.$request.post('/chatInfo/add', msgData).then(res => {\n        if (res.code === '200') {\n          this.inputMsg = '';\n          this.loadMessages(this.chatUserId);\n        }\n      });\n    },\n    scrollToBottom() {\n      const box = this.$refs.msgBox;\n      if (box) {\n        box.scrollTop = box.scrollHeight;\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","JSON","parse","localStorage","getItem","chatUserId","messageList","inputMsg","created","targetId","$route","query","userId","createChatIfNeeded","loadMessages","$message","warning","methods","$request","post","id","then","console","log","get","res","$nextTick","scrollToBottom","sendMsg","trim","msgData","fromId","toId","content","module","code","box","$refs","msgBox","scrollTop","scrollHeight"],"sources":["src/views/front/GoodsDetail.vue"],"sourcesContent":["<template>\n  <div class=\"chat-wrapper\">\n    <div class=\"message-box\" ref=\"msgBox\">\n      <div v-for=\"msg in messageList\" :key=\"msg.id\" class=\"message-item\" :class=\"{ 'me': msg.fromId === user.id }\">\n        <img :src=\"msg.fromAvatar\" class=\"avatar\" />\n        <div class=\"msg-content\">{{ msg.content }}</div>\n      </div>\n    </div>\n    <div class=\"send-box\">\n      <el-input v-model=\"inputMsg\" placeholder=\"请输入消息...\" @keyup.enter=\"sendMsg\" />\n      <el-button type=\"primary\" @click=\"sendMsg\">发送</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Chat',\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      chatUserId: null,            // 当前聊天对象 ID\n      messageList: [],             // 消息列表\n      inputMsg: '',                // 当前输入框内容\n    }\n  },\n  created() {\n    const targetId = this.$route.query.userId\n    if (targetId) {\n      this.chatUserId = targetId\n      this.createChatIfNeeded(targetId)\n      this.loadMessages(targetId)\n    } else {\n      this.$message.warning('未指定聊天对象')\n    }\n  },\n  methods: {\n    createChatIfNeeded(targetId) {\n      this.$request.post('/chatGroup/add', {\n        userId: this.user.id,\n        chatUserId: targetId\n      }).then(() => {\n        console.log('chatGroup ensured')\n      })\n    },\n    loadMessages(targetId) {\n      this.$request.get(`/chatInfo/list?userId=${this.user.id}&chatUserId=${targetId}`).then(res => {\n        this.messageList = res.data || []\n        this.$nextTick(() => {\n          this.scrollToBottom()\n        })\n      })\n    },\n    sendMsg() {\n      if (!this.inputMsg.trim()) {\n        this.$message.warning('请输入内容')\n        return\n      }\n      const msgData = {\n        fromId: this.user.id,\n        toId: this.chatUserId,\n        content: this.inputMsg,\n        module: 'goods' // 模块类型，可选\n      }\n      this.$request.post('/chatInfo/add', msgData).then(res => {\n        if (res.code === '200') {\n          this.inputMsg = ''\n          this.loadMessages(this.chatUserId)\n        }\n      })\n    },\n    scrollToBottom() {\n      const box = this.$refs.msgBox\n      if (box) {\n        box.scrollTop = box.scrollHeight\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-wrapper {\n  width: 80%;\n  margin: 20px auto;\n  border: 1px solid #eee;\n  border-radius: 8px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  height: 80vh;\n  background: #fff;\n}\n\n.message-box {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  background-color: #f9f9f9;\n}\n\n.message-item {\n  display: flex;\n  align-items: flex-start;\n  margin-bottom: 12px;\n}\n\n.message-item.me {\n  flex-direction: row-reverse;\n}\n\n.message-item .avatar {\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  object-fit: cover;\n  margin: 0 8px;\n}\n\n.msg-content {\n  max-width: 60%;\n  background: #fff;\n  padding: 10px 14px;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n  word-break: break-word;\n  font-size: 14px;\n}\n\n.message-item.me .msg-content {\n  background: #cce6ff;\n}\n\n.send-box {\n  display: flex;\n  gap: 10px;\n  padding: 12px;\n  border-top: 1px solid #eee;\n}\n</style>\n"],"mappings":"AAgBA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,UAAA;MAAA;MACAC,WAAA;MAAA;MACAC,QAAA;IACA;EACA;;EACAC,QAAA;IACA,MAAAC,QAAA,QAAAC,MAAA,CAAAC,KAAA,CAAAC,MAAA;IACA,IAAAH,QAAA;MACA,KAAAJ,UAAA,GAAAI,QAAA;MACA,KAAAI,kBAAA,CAAAJ,QAAA;MACA,KAAAK,YAAA,CAAAL,QAAA;IACA;MACA,KAAAM,QAAA,CAAAC,OAAA;IACA;EACA;EACAC,OAAA;IACAJ,mBAAAJ,QAAA;MACA,KAAAS,QAAA,CAAAC,IAAA;QACAP,MAAA,OAAAZ,IAAA,CAAAoB,EAAA;QACAf,UAAA,EAAAI;MACA,GAAAY,IAAA;QACAC,OAAA,CAAAC,GAAA;MACA;IACA;IACAT,aAAAL,QAAA;MACA,KAAAS,QAAA,CAAAM,GAAA,+BAAAxB,IAAA,CAAAoB,EAAA,eAAAX,QAAA,IAAAY,IAAA,CAAAI,GAAA;QACA,KAAAnB,WAAA,GAAAmB,GAAA,CAAA1B,IAAA;QACA,KAAA2B,SAAA;UACA,KAAAC,cAAA;QACA;MACA;IACA;IACAC,QAAA;MACA,UAAArB,QAAA,CAAAsB,IAAA;QACA,KAAAd,QAAA,CAAAC,OAAA;QACA;MACA;MACA,MAAAc,OAAA;QACAC,MAAA,OAAA/B,IAAA,CAAAoB,EAAA;QACAY,IAAA,OAAA3B,UAAA;QACA4B,OAAA,OAAA1B,QAAA;QACA2B,MAAA;MACA;;MACA,KAAAhB,QAAA,CAAAC,IAAA,kBAAAW,OAAA,EAAAT,IAAA,CAAAI,GAAA;QACA,IAAAA,GAAA,CAAAU,IAAA;UACA,KAAA5B,QAAA;UACA,KAAAO,YAAA,MAAAT,UAAA;QACA;MACA;IACA;IACAsB,eAAA;MACA,MAAAS,GAAA,QAAAC,KAAA,CAAAC,MAAA;MACA,IAAAF,GAAA;QACAA,GAAA,CAAAG,SAAA,GAAAH,GAAA,CAAAI,YAAA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}