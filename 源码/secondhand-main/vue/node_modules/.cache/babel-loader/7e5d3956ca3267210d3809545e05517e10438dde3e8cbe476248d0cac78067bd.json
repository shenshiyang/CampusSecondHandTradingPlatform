{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Comment from '@/components/Comment';\nexport default {\n  name: 'GoodsDetail',\n  components: {\n    Comment\n  },\n  data() {\n    return {\n      id: this.$route.query.id,\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      goods: {},\n      current: '商品详情',\n      form: {},\n      fromVisible: false,\n      addressList: []\n    };\n  },\n  created() {\n    // 浏览量 +1\n    this.$request.put('/goods/updateReadCount/' + this.id).finally(() => this.load());\n    this.loadAddress();\n  },\n  methods: {\n    /** ① 关键修改：建立聊天分组后，带 chatUserId 跳转 */\n    chat(userId) {\n      this.$request.post('/chatGroup/add', {\n        chatUserId: userId,\n        userId: this.user.id\n      }).then(() => {\n        this.$router.push({\n          path: '/front/chat',\n          query: {\n            chatUserId: userId\n          } // ⭐ 路由参数\n        });\n      });\n    },\n\n    handleBuy() {\n      this.form = {};\n      this.fromVisible = true;\n    },\n    addOrder() {\n      if (!this.form.addressId) {\n        return this.$message.warning('请选择收货地址');\n      }\n      this.form.goodsId = this.id;\n      this.$request.post('/orders/add', this.form).then(res => {\n        if (res.code === '200') {\n          this.$message.success('下单成功');\n          this.$router.push('/front/orders');\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    loadAddress() {\n      this.$request.get('/address/selectAll').then(res => {\n        this.addressList = res.data || [];\n      });\n    },\n    addLikes() {\n      const tip = this.goods.userLikes ? '取消点赞成功' : '点赞成功';\n      this.$request.post('/likes/add', {\n        userId: this.user.id,\n        fid: this.goods.id,\n        module: 'goods'\n      }).then(res => {\n        res.code === '200' ? this.$message.success(tip) : this.$message.error(res.msg);\n        this.load();\n      });\n    },\n    addCollect() {\n      const tip = this.goods.userCollect ? '取消收藏成功' : '收藏成功';\n      this.$request.post('/collect/add', {\n        userId: this.user.id,\n        fid: this.goods.id,\n        module: 'goods',\n        goodsName: this.goods.name,\n        goodsImg: this.goods.img\n      }).then(res => {\n        res.code === '200' ? this.$message.success(tip) : this.$message.error(res.msg);\n        this.load();\n      });\n    },\n    changeItem(cur) {\n      this.current = cur;\n    },\n    load() {\n      this.$request.get('/goods/selectById/' + this.id).then(res => {\n        this.goods = res.data || {};\n      });\n    }\n  }\n};","map":{"version":3,"names":["Comment","name","components","data","id","$route","query","user","JSON","parse","localStorage","getItem","goods","current","form","fromVisible","addressList","created","$request","put","finally","load","loadAddress","methods","chat","userId","post","chatUserId","then","$router","push","path","handleBuy","addOrder","addressId","$message","warning","goodsId","res","code","success","error","msg","get","addLikes","tip","userLikes","fid","module","addCollect","userCollect","goodsName","goodsImg","img","changeItem","cur"],"sources":["src/views/front/GoodsDetail.vue"],"sourcesContent":["<template>\n  <div class=\"detail-wrapper\">\n    <div class=\"detail-top\">\n      <!-- 商品图片 -->\n      <img :src=\"goods.img\"\n           alt=\"goods\"\n           class=\"goods-img\"/>\n\n      <!-- 商品信息 -->\n      <div class=\"right-box\">\n        <div class=\"goods-info\">\n          <div class=\"goods-title\">{{ goods.name }}</div>\n\n          <div class=\"meta-info\">\n            <span><i class=\"el-icon-view\"/> 浏览 {{ goods.readCount }}</span>\n            <span><i class=\"el-icon-thumb\"/> 点赞 {{ goods.likesCount }}</span>\n            <span><i class=\"el-icon-star-off\"/> 收藏 {{ goods.collectCount }}</span>\n          </div>\n\n          <div class=\"goods-price\">￥{{ goods.price }}</div>\n\n          <div class=\"detail-line\"><span>发货地：</span>{{ goods.address }}</div>\n          <div class=\"detail-line seller-line\">\n            <span>卖家：</span>\n            <img :src=\"goods.userAvatar\" class=\"avatar\" />\n            <span>{{ goods.userName }}</span>\n            <i class=\"el-icon-chat-dot-round chat-icon\"\n               @click=\"chat(goods.userId)\"/>\n          </div>\n          <div class=\"detail-line\"><span>发布日期：</span>{{ goods.date }}</div>\n        </div>\n\n        <!-- 操作按钮 -->\n        <div class=\"button-group\">\n          <el-button v-if=\"!goods.userLikes\"\n                     @click=\"addLikes\"\n                     class=\"like-button\">👍 点赞</el-button>\n          <el-button v-else\n                     @click=\"addLikes\"\n                     class=\"like-button liked\">✅ 已点赞</el-button>\n\n          <el-button v-if=\"!goods.userCollect\"\n                     @click=\"addCollect\"\n                     class=\"collect-button\">❤️ 收藏</el-button>\n          <el-button v-else\n                     @click=\"addCollect\"\n                     class=\"collect-button collected\">💔 已收藏</el-button>\n\n          <el-button class=\"chat-button\"\n                     @click=\"chat(goods.userId)\">💬 联系卖家</el-button>\n          <el-button class=\"buy-button\"\n                     @click=\"handleBuy\">立即购买</el-button>\n        </div>\n      </div>\n    </div>\n\n    <!-- 商品详情 / 评论 -->\n    <div>\n      <div class=\"tab-bar\">\n        <div :class=\"{active: current==='商品详情'}\"\n             @click=\"changeItem('商品详情')\">商品详情</div>\n        <div :class=\"{active: current==='商品评论'}\"\n             @click=\"changeItem('商品评论')\">商品评论</div>\n      </div>\n\n      <div v-if=\"current==='商品详情'\" v-html=\"goods.content\"/>\n      <div v-else class=\"card\">\n        <Comment :fid=\"id\" module=\"goods\"/>\n      </div>\n    </div>\n\n    <!-- 下单弹窗 -->\n    <el-dialog\n      title=\"选择收货地址\"\n      :visible.sync=\"fromVisible\"\n      width=\"30%\"\n      :close-on-click-modal=\"false\"\n      destroy-on-close>\n      <div style=\"padding:0 20px\">\n        <el-radio-group v-model=\"form.addressId\">\n          <el-radio v-for=\"item in addressList\"\n                    :key=\"item.id\"\n                    :label=\"item.id\"\n                    style=\"margin-bottom:10px\">\n            {{ item.name }} {{ item.address }} {{ item.phone }}\n          </el-radio>\n        </el-radio-group>\n        <a v-if=\"addressList.length===0\"\n           href=\"/front/address\"\n           target=\"_blank\">还没有收货地址？去创建</a>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"fromVisible=false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"addOrder\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport Comment from '@/components/Comment'\nexport default {\n  name: 'GoodsDetail',\n  components: { Comment },\n  data () {\n    return {\n      id: this.$route.query.id,\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      goods: {},\n      current: '商品详情',\n      form: {},\n      fromVisible: false,\n      addressList: []\n    }\n  },\n  created () {\n    // 浏览量 +1\n    this.$request.put('/goods/updateReadCount/' + this.id)\n      .finally(() => this.load())\n    this.loadAddress()\n  },\n  methods: {\n    /** ① 关键修改：建立聊天分组后，带 chatUserId 跳转 */\n    chat (userId) {\n      this.$request.post('/chatGroup/add',\n        { chatUserId: userId, userId: this.user.id })\n        .then(() => {\n          this.$router.push({\n            path: '/front/chat',\n            query: { chatUserId: userId }   // ⭐ 路由参数\n          })\n        })\n    },\n    handleBuy () {\n      this.form = {}\n      this.fromVisible = true\n    },\n    addOrder () {\n      if (!this.form.addressId) {\n        return this.$message.warning('请选择收货地址')\n      }\n      this.form.goodsId = this.id\n      this.$request.post('/orders/add', this.form).then(res => {\n        if (res.code === '200') {\n          this.$message.success('下单成功')\n          this.$router.push('/front/orders')\n        } else {\n          this.$message.error(res.msg)\n        }\n      })\n    },\n    loadAddress () {\n      this.$request.get('/address/selectAll').then(res => {\n        this.addressList = res.data || []\n      })\n    },\n    addLikes () {\n      const tip = this.goods.userLikes ? '取消点赞成功' : '点赞成功'\n      this.$request.post('/likes/add', {\n        userId: this.user.id,\n        fid: this.goods.id,\n        module: 'goods'\n      }).then(res => {\n        res.code === '200' ? this.$message.success(tip) : this.$message.error(res.msg)\n        this.load()\n      })\n    },\n    addCollect () {\n      const tip = this.goods.userCollect ? '取消收藏成功' : '收藏成功'\n      this.$request.post('/collect/add', {\n        userId: this.user.id,\n        fid: this.goods.id,\n        module: 'goods',\n        goodsName: this.goods.name,\n        goodsImg: this.goods.img\n      }).then(res => {\n        res.code === '200' ? this.$message.success(tip) : this.$message.error(res.msg)\n        this.load()\n      })\n    },\n    changeItem (cur) { this.current = cur },\n    load () {\n      this.$request.get('/goods/selectById/' + this.id).then(res => {\n        this.goods = res.data || {}\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.detail-wrapper   { margin:0 auto; padding:10px 0; width:50%; }\n.detail-top       { display:flex; gap:20px; margin-bottom:40px; }\n.goods-img        { width:50%; height:400px; object-fit:cover; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.1); }\n.right-box        { flex:1; width:0; }\n.goods-info       { display:flex; flex-direction:column; gap:12px; }\n.goods-title      { font-size:28px; font-weight:600; color:#333; }\n.meta-info        { display:flex; gap:20px; font-size:14px; color:#888; }\n.goods-price      { font-size:26px; color:#ff3c3c; font-weight:700; margin:10px 0; }\n.detail-line      { font-size:15px; color:#444; }\n.detail-line span { font-weight:500; color:#888; margin-right:4px; }\n.seller-line      { display:flex; align-items:center; }\n.avatar           { width:26px; height:26px; border-radius:50%; margin:0 6px; border:1px solid #eee; object-fit:cover; }\n.chat-icon        { font-size:16px; margin-left:6px; color:#409EFF; cursor:pointer; transition:.2s; }\n.chat-icon:hover  { transform:scale(1.2); }\n\n.button-group     { display:flex; gap:12px; flex-wrap:nowrap; margin-top:30px; }\n.el-button        { min-width:100px; height:40px; font-weight:700; transition:.3s; white-space:nowrap; }\n/* 按钮配色 */\n.like-button      { background:#ff7f50; color:#fff; border:none; }\n.like-button:hover{ background:#ff4500; transform:scale(1.05); }\n.liked            { background:#aaa !important; }\n.collect-button   { background:#f6c344; color:#fff; border:none; }\n.collect-button:hover{ background:#e8a600; transform:scale(1.05); }\n.collected        { background:#888 !important; }\n.chat-button      { border:1px solid #409EFF; color:#409EFF; background:#fff; }\n.chat-button:hover{ background:#409EFF; color:#fff; transform:scale(1.05); }\n.buy-button       { background:#ff0055; color:#fff; border:none; }\n.buy-button:hover { background:#e6004c; transform:scale(1.05); }\n/* tab */\n.tab-bar          { display:flex; border-bottom:1px solid orangered; margin-bottom:10px; }\n.tab-bar>div      { padding:10px 20px; cursor:pointer; }\n.active           { background:orangered; color:#fff; }\n</style>\n"],"mappings":";AAoGA,OAAAA,OAAA;AACA;EACAC,IAAA;EACAC,UAAA;IAAAF;EAAA;EACAG,KAAA;IACA;MACAC,EAAA,OAAAC,MAAA,CAAAC,KAAA,CAAAF,EAAA;MACAG,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,KAAA;MACAC,OAAA;MACAC,IAAA;MACAC,WAAA;MACAC,WAAA;IACA;EACA;EACAC,QAAA;IACA;IACA,KAAAC,QAAA,CAAAC,GAAA,kCAAAf,EAAA,EACAgB,OAAA,YAAAC,IAAA;IACA,KAAAC,WAAA;EACA;EACAC,OAAA;IACA;IACAC,KAAAC,MAAA;MACA,KAAAP,QAAA,CAAAQ,IAAA,mBACA;QAAAC,UAAA,EAAAF,MAAA;QAAAA,MAAA,OAAAlB,IAAA,CAAAH;MAAA,GACAwB,IAAA;QACA,KAAAC,OAAA,CAAAC,IAAA;UACAC,IAAA;UACAzB,KAAA;YAAAqB,UAAA,EAAAF;UAAA;QACA;MACA;IACA;;IACAO,UAAA;MACA,KAAAlB,IAAA;MACA,KAAAC,WAAA;IACA;IACAkB,SAAA;MACA,UAAAnB,IAAA,CAAAoB,SAAA;QACA,YAAAC,QAAA,CAAAC,OAAA;MACA;MACA,KAAAtB,IAAA,CAAAuB,OAAA,QAAAjC,EAAA;MACA,KAAAc,QAAA,CAAAQ,IAAA,qBAAAZ,IAAA,EAAAc,IAAA,CAAAU,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAJ,QAAA,CAAAK,OAAA;UACA,KAAAX,OAAA,CAAAC,IAAA;QACA;UACA,KAAAK,QAAA,CAAAM,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA;MACA;IACA;IACApB,YAAA;MACA,KAAAJ,QAAA,CAAAyB,GAAA,uBAAAf,IAAA,CAAAU,GAAA;QACA,KAAAtB,WAAA,GAAAsB,GAAA,CAAAnC,IAAA;MACA;IACA;IACAyC,SAAA;MACA,MAAAC,GAAA,QAAAjC,KAAA,CAAAkC,SAAA;MACA,KAAA5B,QAAA,CAAAQ,IAAA;QACAD,MAAA,OAAAlB,IAAA,CAAAH,EAAA;QACA2C,GAAA,OAAAnC,KAAA,CAAAR,EAAA;QACA4C,MAAA;MACA,GAAApB,IAAA,CAAAU,GAAA;QACAA,GAAA,CAAAC,IAAA,kBAAAJ,QAAA,CAAAK,OAAA,CAAAK,GAAA,SAAAV,QAAA,CAAAM,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA,KAAArB,IAAA;MACA;IACA;IACA4B,WAAA;MACA,MAAAJ,GAAA,QAAAjC,KAAA,CAAAsC,WAAA;MACA,KAAAhC,QAAA,CAAAQ,IAAA;QACAD,MAAA,OAAAlB,IAAA,CAAAH,EAAA;QACA2C,GAAA,OAAAnC,KAAA,CAAAR,EAAA;QACA4C,MAAA;QACAG,SAAA,OAAAvC,KAAA,CAAAX,IAAA;QACAmD,QAAA,OAAAxC,KAAA,CAAAyC;MACA,GAAAzB,IAAA,CAAAU,GAAA;QACAA,GAAA,CAAAC,IAAA,kBAAAJ,QAAA,CAAAK,OAAA,CAAAK,GAAA,SAAAV,QAAA,CAAAM,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA,KAAArB,IAAA;MACA;IACA;IACAiC,WAAAC,GAAA;MAAA,KAAA1C,OAAA,GAAA0C,GAAA;IAAA;IACAlC,KAAA;MACA,KAAAH,QAAA,CAAAyB,GAAA,6BAAAvC,EAAA,EAAAwB,IAAA,CAAAU,GAAA;QACA,KAAA1B,KAAA,GAAA0B,GAAA,CAAAnC,IAAA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}